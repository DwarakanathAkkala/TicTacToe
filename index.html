<!DOCTYPE html>
<html lang="en">
<head>
    <!--Meta Tags for SEO-->
    <meta name="author" content="Dwarakanath Akkala">
    <meta name="language" content="english">
    <meta name="description" content="Play & Win."/>
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content=”notranslate” />
    <meta name="revised" content="Wednesday, November 1st, 2023, 11:30 pm" />
    <meta name="rating" content="safe for kids">

    <!--Open Graph Protocol Meta Tags-->
    <meta property="og:title" content="Tic Tac Toe">
    <meta property="og:type" content="website">
    <!-- <meta property="og:url" content="https://tic-tac-toe-xox.netlify.app/"> -->
    <meta property="og:description" content="You can call it XOX :-)">
    <meta property="og:image" content="https://tic-tac-toe-xox.netlify.app/logo.png">
    <meta property="og:site_name" content="Tic Tac Toe">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe (XOX)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Fascinate&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel = "icon" href="https://tic-tac-toe-xox.netlify.app/logo.png" type = "image/x-icon">
</head>
<body>
    <div class="pageLoader">
            <div class="container text-center">
                <h1>Tic Tac Toe</h1>
                <br>
                <figure>
                    <img src="loaderLogo.png" alt="Trulli" style="width:100%">
                    <figcaption>Made with Love <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.2426 4.75736C22.5053 7.02472 22.583 10.637 20.4786 12.993L11.9999 21.485L3.52138 12.993C1.41705 10.637 1.49571 7.01901 3.75736 4.75736C5.51545 2.99926 8.09315 2.56029 10.2605 3.44044L6.34315 7.35843L7.75736 8.77264L12 4.53L11.9872 4.51617C11.9918 4.52028 11.9964 4.5244 12.001 4.52853C14.35 2.42 17.98 2.49 20.2426 4.75736Z" fill="rgba(255,0,0,0.9)"></path></svg> by Dwaraka</figcaption>
                </figure> 
            </div>
    </div>
    <header>
        <div class="container mt-5">
            <div class="row text-center">
                <h1>Tic Tac Toe</h1>
            </div>
        </div>    
    </header>

    <main>
        <div class="container" id="onlineMode">
            <br/><br>
            <h4 id="playerNames" class="text-center"></h4>
            <br/>
            <h6 id="currTurnField" class="text-center"></h6>
            <span id="sign"></span>
            <span id="currTurn"></span>
            <table class="table text-center mt-5">
                <tr>
                    <td id="cell1"><input id="pos1" class="gameGrid" type="text" size="1" value="" disabled></td>
                    <td id="cell2"><input id="pos2" class="gameGrid" type="text" size="1" value="" disabled></td>
                    <td id="cell3"><input id="pos3" class="gameGrid" type="text" size="1" value="" disabled></td>
                </tr>
                <tr>
                    <td id="cell4"><input id="pos4" class="gameGrid" type="text" size="1" value="" disabled></td>
                    <td id="cell5"><input id="pos5" class="gameGrid" type="text" size="1" value="" disabled></td>
                    <td id="cell6"><input id="pos6" class="gameGrid" type="text" size="1" value="" disabled></td>
                </tr>
                <tr>
                    <td id="cell7"><input id="pos7" class="gameGrid" type="text" size="1" value="" disabled></td>
                    <td id="cell8"><input id="pos8" class="gameGrid" type="text" size="1" value="" disabled></td>
                    <td id="cell9"><input id="pos9" class="gameGrid" type="text" size="1" value="" disabled></td>
                </tr>
            </table>

            <div class="alert alert-danger text-center" id="resultAlert" role="alert"></div>

            <!-- Game Mode Buttons -->
            <div class="row">
                <div class="col">
                    <button type="button" class="btn btn-primary" id="joinGamePlay" data-bs-toggle="modal" data-bs-target="#joinGameModal">Online Player</button>
                </div>
                <div class="col">
                    <button type="button" class="btn btn-primary" id="createGamePlay" data-bs-toggle="modal" data-bs-target="#createGameModal">Friend</button>
                </div>
            </div>

            <!-- Game Play Buttons -->
            <div class="row">
                <div class="col">
                    <button type="button" class="btn btn-danger" id="onlineMainMenu" data-bs-toggle="modal" data-bs-target="#mainMenuModal">Main Menu</button>
                </div>
                <div class="col">
                    <button type="button" class="btn btn-warning" onclick="onlineGameRestart()" id="restarOnlineGame" disabled>Restart</button>
                </div>
            </div>

            <!-- Game with Online Player Modal -->
            <div class="modal fade" id="joinGameModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                      <div class="modal-header">Game Preferences</div>
                      <div class="modal-body">

                        <div class="row">
                            <div class="col-4">
                                <label for="playerName">Your Name</label>
                            </div>
                            <div class="col prefCol">
                                <input type="text" class="form-control" id="yourName" name="playerName" placeholder="Don't let name to be 'Player'" aria-label="Player 1">
                            </div>
                            <div id="findPlayerValidation">
                                Please enter a valid input
                            </div>
                        </div>
                          
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-primary" id="findPlayer" onclick="findPlayer()">Search for Players...</button>
                      </div>
                  </div>
                </div>
            </div>

            <!-- Game with a Friend Modal -->
            <div class="modal fade" id="createGameModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-body">
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs justify-content-center" id="gameTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                  <button class="nav-link active" id="create-tab" data-bs-toggle="tab" data-bs-target="#create" type="button" role="tab" aria-controls="create" aria-selected="true">Create</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                  <button class="nav-link" id="join-tab" data-bs-toggle="tab" data-bs-target="#join" type="button" role="tab" aria-controls="join" aria-selected="false">Join</button>
                                </li>
                            </ul>
  
                            <!-- Tab panes -->
                            <div class="tab-content">
                              <div class="tab-pane active" id="create" role="tabpanel" aria-labelledby="create-tab" tabindex="0">
                                <div class="row mt-3 mb-3">
                                    <div class="col-4">
                                        <label for="playerName">Your Name</label>
                                    </div>
                                    <div class="col prefCol">
                                        <input type="text" id="roomUserName" class="form-control" name="playerName" placeholder="Don't let name to be 'Player'" >
                                        <div class="roomPlayerValidation">
                                            Please enter valid input
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-primary" id="createGame" onclick="createJoinGame(document.getElementById('roomUserName').value, null)">Create Game</button>
                              </div>

                              <div class="tab-pane" id="join" role="tabpanel" aria-labelledby="join-tab" tabindex="0">
                                <div class="row mt-3 mb-3">
                                    <div class="col-3">
                                        <label for="playerName">Your Name</label>
                                    </div>
                                    <div class="col prefCol">
                                        <input type="text" id="joiningUserName" class="form-control" name="playerName" placeholder="Don't let name to be 'Player'" >
                                        <div class="roomPlayerValidation">
                                            Please enter valid input
                                        </div>
                                        <div id="duplicatePlayerValidation">Already player exists with same name in the room</div>
                                    </div>
                                </div>
                                <div class="row mt-3 mb-3">
                                    <div class="col-3">
                                        <label for="roomName">Room Name</label>
                                    </div>
                                    <div class="col prefCol">
                                        <input type="text" id="roomName" class="form-control" name="roomName" placeholder="Type Carefully. Do not enter other rooms." >
                                    </div>
                                </div>

                                <button type="button" class="btn btn-primary" id="joinGame" onclick="createJoinGame(document.getElementById('joiningUserName').value, document.getElementById('roomName').value)">Join Game</button>
                              </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Wait for Private Player to Join Modal -->
            <div class="modal fade" id="waitForPlayerModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header justify-content-center" id="waitingPlayerText"><b>Waiting for Player to Join</b></div>
                        <div class="modal-body">
                            <div class="row" id="roomCodeDisplay"></div>
                            <div class="d-flex justify-content-center">
                                <div class="spinner-border text-info" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>                   
                    </div>
                </div>
            </div>

            <!-- Wait for Private Player to Join Modal -->
            <div class="modal fade" id="waitForRandomPlayerModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header justify-content-center" id="waitingPlayerText"><b>Dwaraka's Bot is here</b></div>
                        <div class="modal-body">
                            <div class="d-flex justify-content-center"><b>Seeking a game partner soon....</b></div><br>
                            <div class="d-flex justify-content-center">
                                <div class="spinner-border text-info" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>                   
                    </div>
                </div>
            </div>

        </div>

        <div class="container" id="localMode">
            <br/><br>
            <h4 id="offlinePlayerNames" class="text-center"></h4>
            <br/>
            <h6 id="offlineCurrTurnField" class="text-center"></h6>
            <span id="offlineSign"></span>
            <span id="offlineCurrTurn"></span>
            <table class="table text-center mt-5">
                <tr>
                    <td id="cell1" class="offlineGridCell"><input class="offlineGameGrid" type="text" size="1" value="" disabled></td>
                    <td id="cell2" class="offlineGridCell"><input class="offlineGameGrid" type="text" size="1" value="" disabled></td>
                    <td id="cell3" class="offlineGridCell"><input class="offlineGameGrid" type="text" size="1" value="" disabled></td>
                </tr>
                <tr>
                    <td id="cell4" class="offlineGridCell"><input class="offlineGameGrid" type="text" size="1" value="" disabled></td>
                    <td id="cell5" class="offlineGridCell"><input class="offlineGameGrid" type="text" size="1" value="" disabled></td>
                    <td id="cell6" class="offlineGridCell"><input class="offlineGameGrid" type="text" size="1" value="" disabled></td>
                </tr>
                <tr>
                    <td id="cell7" class="offlineGridCell"><input class="offlineGameGrid" type="text" size="1" value="" disabled></td>
                    <td id="cell8" class="offlineGridCell"><input class="offlineGameGrid" type="text" size="1" value="" disabled></td>
                    <td id="cell9" class="offlineGridCell"><input class="offlineGameGrid" type="text" size="1" value="" disabled></td>
                </tr>
            </table>

            <div class="text-center mt-5" >
                <!-- Button trigger modal -->
                <div class="row">
                    <div class="col">
                        <button type="button" class="btn btn-primary" id="playGameBtn" data-bs-toggle="modal" data-bs-target="#exampleModal">Offline Mode</button>
                    </div>
                    <div class="col">
                        <button type="button" class="btn btn-primary" id="onlinePlayGameBtn">Online Mode</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col" id="changePrefBtn" style="display: none;">
                        <button type="button" class="btn btn-danger"  data-bs-toggle="modal" data-bs-target="#preferConfirmModal">Change Preferences</button>
                    </div>
                    <div class="col" id="restartBtn" style="display: none;">
                        <button type="button" class="btn btn-warning"  onclick="restartGame()">Restart Game</button>
                    </div>
                </div>    
            </div>
  
            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">Game Preferences</div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-4 prefCol">
                                <input type="text" class="form-control" id="player1" name="player1" value="Player 1" placeholder="Player 1" aria-label="Player 1">
                            </div>
                            <div class="col-1 prefCol">
                                <button id="player1Sign" class="btn btn-primary prefColBtn" disabled>X</button>
                            </div>
                            <div class="col-2 prefCol">
                                <button class="btn btn-success prefColBtn" onclick="changeSign()">Flip</button>
                            </div>
                            <div class="col-1 prefCol">
                                <button id="player2Sign" class="btn btn-primary prefColBtn" disabled>O</button>
                            </div>

                            <div class="col-4 prefCol">
                                <input type="text" class="form-control" id="player2" name="player2" value="Player 2" placeholder="Player 2" aria-label="Player 2">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" onclick="changePreferences()" data-bs-dismiss="modal">Game On!</button>
                    </div>
                </div>
              </div>
            </div>
            
             <!-- Modal -->
             <div class="modal fade" id="preferConfirmModal" tabindex="-1" aria-labelledby="preferConfirmModal" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                      <div class="modal-header">Any game progress would be lost. Would you like to continue?</div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-dismiss="modal">Yes. Change Preferences!</button>
                      </div>
                  </div>
                </div>
              </div>
            

        </div>
    </main>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="/script.js"></script>
    <script src="/js/onlineGame.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        socket.on('playing', (e) => {
        const foundObject = (e.allPlayers).find(obj => obj.player1.displayName == userName || obj.player2.displayName == userName);
        console.log("Found Match Object", foundObject)
        p1id = foundObject.player1.move
        p2id = foundObject.player2.move

        if ((foundObject.sum) % 2 == 0) {
            document.getElementById("currTurn").innerText = "O";
            document.getElementById("currTurnField").innerText = "It's " + foundObject.player2.displayName + " turn";
        }
        else {
            document.getElementById("currTurn").innerText = "X";
            document.getElementById("currTurnField").innerText = "It's " + foundObject.player1.displayName + " turn";
        }

        if (p1id != '') {
            console.log("Entered X Change")
            document.getElementById(p1id).value = "X"
            document.getElementById(p1id).disabled = true;
            winCheck(userName, foundObject.sum);
        }
        if (p2id != '') {
            document.getElementById(p2id).value = "O"
            document.getElementById(p2id).disabled = true;
            winCheck(userName, foundObject.sum);
        }

        
    });

    socket.on('privateRoom', (e) => {
        console.log(e);
    })

    // socket.on('join', (e) => {
    //     console.log(e)
    // })
    </script>
</body>
</html> 